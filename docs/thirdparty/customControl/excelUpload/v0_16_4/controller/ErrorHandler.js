"use strict";sap.ui.define(["../types","./Util","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,r,o){function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const l=e["ErrorTypes"];const n=s(t);class i{errorResults=[];constructor(e){this.errorResults=[];this.excelUploadController=e}setErrorResults(e){this.errorResults=e}addToErrorsResults(e){this.errorResults=this.errorResults.concat(e)}addParsingError(e){this.errorResults.push(e)}getErrorResults(){return this.errorResults}checkMandatoryColumns(e,t,r,o,s){const l=[...new Set([...r,...o])];this.checkMandatoryFields(e,l,s)}checkMandatoryFields(e,t,r){if(!t){return}for(const o of t){const t=r[o]?.label;if(!t){continue}for(const[r,s]of e.entries()){const e=n.getValueFromRow(s,t,o,this.excelUploadController.component.getFieldMatchType());const i={title:this.excelUploadController.util.geti18nText("mandatoryFieldNotFilled",[t]),type:l.MandatoryFieldNotFilled,row:r+2,counter:1};if(e===""||e===undefined){this.errorResults.push(i)}}}}checkColumnNames(e,t,r){for(let o=0;o<e.length;o++){const s=e[o];let n=false;for(const e in r){if(r.hasOwnProperty(e)){if(t==="label"){if(r[e].label===s){n=true;break}}if(t==="labelTypeBrackets"){if(s.includes(`[${e}]`)){n=true;break}}}}if(!n){const e={title:this.excelUploadController.util.geti18nText("columnNotFound",[s]),type:l.ColumnNotFound,counter:1};this.errorResults.push(e)}}}checkKeyColumns(e,t,r){const o=[];for(let s=0;s<t.length;s++){const n=t[s];let i=false;for(const t in e){if(e[t].includes(`[${n}]`)){i=true;o.push(n);break}}if(!i){const e=r[n]?.label?r[n].label:n;const t={title:this.excelUploadController.util.geti18nText("keyColumnNotFound",[e]),type:l.ColumnNotFound,counter:1};this.errorResults.push(t)}}return o}areErrorsPresent(){if(this.errorResults.some(e=>e.counter>0)){return true}return false}async displayErrors(){const e=new o({strict:this.excelUploadController.component.getStrict()});if(!this.errorDialog){this.errorDialog=await r.load({name:"cc.excelUpload.v0_16_4.fragment.ErrorDialog",type:"XML",controller:this})}this.errorDialog.setModel(this.excelUploadController.componentI18n,"i18n");this.errorDialog.setModel(e,"info");this.errorDialog.setModel(new o,"errorData");const t=this.groupErrors(this.errorResults);const s=this.sortErrorsByTitle(t);this.errorDialog.getModel("errorData").setData(s);this.errorDialog.open()}groupErrors(e){const t=e.filter(e=>e.counter!==0);const r=t.filter(e=>e.type.group===true);const o=r.reduce((e,t)=>{if(!e[t.title]){e[t.title]=[]}const r=this.excelUploadController.util.geti18nText("errorInRow",[t.row]);e[t.title].push(r);return e},{});const s=[];for(const e in o){s.push({title:e,description:o[e].join("\n")})}const l=s.concat(t.filter(e=>e.type.group===false));return l}onCloseErrorDialog(){this.errorDialog.close();this.excelUploadController.resetContent()}onContinue(){this.errorDialog.close();this.excelUploadController.setDataRows()}sortErrorsByTitle(e){return e.sort((e,t)=>{if(e.title<t.title){return-1}if(e.title>t.title){return 1}return 0})}}return i});
//# sourceMappingURL=ErrorHandler.js.map